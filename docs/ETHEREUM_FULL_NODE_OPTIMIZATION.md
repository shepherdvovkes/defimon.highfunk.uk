# üöÄ Ethereum Full Node Optimization Guide

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π Ethereum –Ω–æ–¥—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

## üéØ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–π –Ω–æ–¥—ã

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **RAM**: 16GB+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 32GB)
- **CPU**: 8+ —è–¥–µ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 16+)
- **–î–∏—Å–∫**: 2TB+ SSD (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è NVMe)
- **–°–µ—Ç—å**: –í—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (100Mbps+)

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: 1-2 –Ω–µ–¥–µ–ª–∏
- **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ

## üîß –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ swappiness –¥–ª—è Ethereum
echo 'vm.swappiness=10' >> /etc/sysctl.conf
echo 'vm.dirty_ratio=15' >> /etc/sysctl.conf
echo 'vm.dirty_background_ratio=5' >> /etc/sysctl.conf
echo 'vm.max_map_count=262144' >> /etc/sysctl.conf
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ TCP –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
echo 'net.core.rmem_max=134217728' >> /etc/sysctl.conf
echo 'net.core.wmem_max=134217728' >> /etc/sysctl.conf
echo 'net.core.rmem_default=67108864' >> /etc/sysctl.conf
echo 'net.core.wmem_default=67108864' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem=4096 87380 67108864' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_wmem=4096 65536 67108864' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_congestion_control=bbr' >> /etc/sysctl.conf
echo 'net.core.netdev_max_backlog=5000' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_max_syn_backlog=65536' >> /etc/sysctl.conf
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
echo 'fs.file-max=2097152' >> /etc/sysctl.conf
echo 'fs.nr_open=2097152' >> /etc/sysctl.conf
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è SSD
```bash
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è SSD
echo 'vm.dirty_ratio=10' >> /etc/sysctl.conf
echo 'vm.dirty_background_ratio=3' >> /etc/sysctl.conf
```

## üê≥ Docker –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
```yaml
deploy:
  resources:
    limits:
      memory: 12G
      cpus: '6.0'
    reservations:
      memory: 6G
      cpus: '3.0'
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã
```yaml
ulimits:
  nofile:
    soft: 65536
    hard: 65536
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```yaml
sysctls:
  - net.core.rmem_max=134217728
  - net.core.wmem_max=134217728
  - net.core.rmem_default=67108864
  - net.core.wmem_default=67108864
  - vm.max_map_count=262144
```

## ‚öôÔ∏è Geth –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```toml
[Eth]
SyncMode = "full"
Cache = 8192
DatabaseCache = 4096
TrieCache = 256
SnapshotCache = 256
StateCache = 256
```

### –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```toml
[Node]
MaxPeers = 50
HTTPPort = 8545
WSPort = 8546
P2P = 30303
HTTPEnabled = true
WSEnabled = true
HTTPCors = ["*"]
HTTPVirtualHosts = ["*"]
HTTPModules = ["eth", "net", "web3", "debug", "txpool"]
WSModules = ["eth", "net", "web3", "debug", "txpool"]
```

### P2P –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```toml
[Node.P2P]
MaxPeers = 50
NAT = "any"
DiscoveryV5 = true
LightClient = false
```

### –ú–µ—Ç—Ä–∏–∫–∏
```toml
[Metrics]
Enabled = true
HTTP = ":6060"
HTTPCors = ["*"]
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–æ–≤
- **–ü–∞–º—è—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM –∏ –∫—ç—à–∞
- **–î–∏—Å–∫**: –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è
- **–°–µ—Ç—å**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Ä–æ–≤ –∏ –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
- **CPU**: –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

### –ö–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_syncing","params":[],"id":1}' \
  http://localhost:8545

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏—Ä–æ–≤
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"net_peerCount","params":[],"id":1}' \
  http://localhost:8545

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
docker stats defimon-blockchain-service

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
df -h /data/ethereum
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Geth
docker logs defimon-blockchain-service | grep -i sync

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
netstat -tuln | grep 30303

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏—Ä–æ–≤
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"admin_peers","params":[],"id":1}' \
  http://localhost:8545
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
free -h
docker stats --no-stream defimon-blockchain-service

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
docker exec defimon-blockchain-service geth --exec "eth.getBlock('latest')" attach
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∏—Å–∫–æ–º
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
df -h /data/ethereum

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–∏—Å–∫–∞
dd if=/dev/zero of=/data/ethereum/test bs=1M count=1000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (–¥–ª—è HDD)
sudo e2fsck -f /dev/sdX
```

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
```bash
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫—ç—à–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º —Å 32GB+ RAM
CACHE_SIZE=16384
DATABASE_CACHE=8192
TRIE_CACHE=512
SNAPSHOT_CACHE=512
STATE_CACHE=512
```

### –î–ª—è SSD —Å–∏—Å—Ç–µ–º
```bash
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è SSD
--database.ancient /data/ethereum/chaindata/ancient
--cache 12288
```

### –î–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
--maxpeers 100
--discovery.v5
--nat any
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –§–∞–π—Ä–≤–æ–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ—Ä—Ç–æ–≤
ufw allow 30303/tcp
ufw allow 30303/udp
ufw allow 8545/tcp
ufw allow 8546/tcp
ufw deny 8545/tcp from any to any
ufw deny 8546/tcp from any to any
```

### RPC –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```bash
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ RPC
--http.addr 127.0.0.1
--ws.addr 127.0.0.1
--http.corsdomain "http://localhost:3000"
```

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–¥ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ RAM –¥–æ 64GB+
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ NVMe –¥–∏—Å–∫–æ–≤
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ CPU –¥–æ 32+ —è–¥–µ—Ä

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ–ª–Ω–∞—è Ethereum –Ω–æ–¥–∞ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫. –°–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
1. **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤** - –º–∏–Ω–∏–º—É–º 16GB RAM, 2TB SSD
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–¥—Ä–∞
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
5. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –¥–∞–Ω–Ω—ã—Ö

–°–ª–µ–¥—É—è —ç—Ç–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º, –≤–∞—à–∞ –ø–æ–ª–Ω–∞—è Ethereum –Ω–æ–¥–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ! üöÄ
