# Инструмент для обрезки видео с черными границами

Универсальный инструмент на Python для автоматического определения и удаления черных границ в видео файлах.

## Возможности

- ✅ Автоматическое определение черных границ слева и справа
- ✅ Поддержка формата 4:3 и других соотношений сторон
- ✅ Обработка как отдельных файлов, так и целых папок
- ✅ Настраиваемый порог для определения черных пикселей
- ✅ Подробная информация о процессе обработки
- ✅ Поддержка различных видео форматов (MP4, AVI, MOV и др.)

## Установка

### 1. Установка зависимостей

```bash
pip3 install -r video_crop_requirements.txt
```

Или установите вручную:

```bash
pip3 install opencv-python numpy
```

### 2. Сделайте скрипты исполняемыми

```bash
chmod +x video_crop_tool.py
chmod +x crop_videos.sh
```

## Использование

### Быстрый запуск через bash скрипт

```bash
# Обработать папку с видео
./crop_videos.sh ./видео

# Обработать папку с указанием выходной директории
./crop_videos.sh ./видео ./обрезанные

# Обработать один файл
./crop_videos.sh video.mp4

# Обработать файл с указанием выходного имени
./crop_videos.sh video.mp4 cropped_video.mp4
```

### Прямое использование Python скрипта

```bash
# Обработать один файл
python3 video_crop_tool.py input_video.mp4

# Обработать файл с указанием выходного имени
python3 video_crop_tool.py input_video.mp4 -o output_video.mp4

# Обработать все MP4 файлы в папке
python3 video_crop_tool.py ./видео -d

# Обработать папку с указанием выходной директории
python3 video_crop_tool.py ./видео -o ./обрезанные -d

# Настроить порог для определения черных пикселей (по умолчанию 30)
python3 video_crop_tool.py video.mp4 -t 25

# Обработать файлы с другим расширением
python3 video_crop_tool.py ./видео -d -p "*.avi"
```

## Параметры командной строки

- `input` - Путь к входному видео файлу или директории
- `-o, --output` - Путь к выходному файлу или директории
- `-t, --threshold` - Порог для определения черных пикселей (0-255, по умолчанию: 30)
- `-d, --directory` - Обработать все видео файлы в директории
- `-p, --pattern` - Паттерн для поиска файлов (по умолчанию: *.mp4)

## Как это работает

1. **Анализ границ**: Инструмент анализирует несколько кадров видео для определения стабильных границ черных областей
2. **Определение порога**: Использует настраиваемый порог яркости для различения черных и цветных пикселей
3. **Обрезка**: Удаляет черные границы слева и справа, сохраняя основное содержимое видео
4. **Сохранение**: Создает новый файл с обрезанным видео в том же формате

## Примеры использования

### Обработка папки с видео формата 4:3

Если у вас есть папка `видео` с MP4 файлами, которые имеют черные границы слева и справа:

```bash
# Создаст папку "видео_cropped" с обрезанными файлами
./crop_videos.sh ./видео
```

### Настройка чувствительности

Если инструмент не правильно определяет границы:

```bash
# Уменьшить порог для более точного определения черных областей
python3 video_crop_tool.py video.mp4 -t 20

# Увеличить порог если обрезается слишком много
python3 video_crop_tool.py video.mp4 -t 40
```

### Обработка различных форматов

```bash
# Обработать AVI файлы
python3 video_crop_tool.py ./видео -d -p "*.avi"

# Обработать MOV файлы
python3 video_crop_tool.py ./видео -d -p "*.mov"

# Обработать все видео файлы
python3 video_crop_tool.py ./видео -d -p "*.mp4 *.avi *.mov"
```

## Структура файлов

```
├── video_crop_tool.py          # Основной Python скрипт
├── video_crop_requirements.txt # Зависимости
├── crop_videos.sh              # Bash скрипт для удобного запуска
└── VIDEO_CROP_README.md        # Эта документация
```

## Требования

- Python 3.7+
- OpenCV (opencv-python)
- NumPy
- Достаточно места на диске для выходных файлов

## Устранение неполадок

### Ошибка "Не удалось открыть видео"
- Убедитесь, что файл существует и не поврежден
- Проверьте, что у вас есть права на чтение файла
- Убедитесь, что формат файла поддерживается OpenCV

### Неправильная обрезка границ
- Попробуйте изменить порог с помощью параметра `-t`
- Убедитесь, что черные границы действительно черные (не темно-серые)

### Медленная обработка
- Обработка больших файлов может занять время
- Инструмент показывает прогресс каждые 100 кадров

## Лицензия

Этот инструмент создан для внутреннего использования в проекте DeFiMon.
